DELIMITER $$

CREATE FUNCTION fix_utf8(str TEXT)
RETURNS TEXT
DETERMINISTIC
BEGIN
    RETURN CONVERT(
        CAST(CONVERT(str USING latin1) AS BINARY)
    USING utf8mb4);
END$$

DELIMITER ;
